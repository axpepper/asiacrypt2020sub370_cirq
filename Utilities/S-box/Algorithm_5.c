#include <stdio.h>
#include <stdlib.h>

/******
 * The input of Algorithm 3 can be explained as follows:
 * U[0]=x_0, U[1]=x_1, U[2]=x_2, U[3]=x_3, U[4]=x_4, U[5]=x_5, U[6]=x_6, U[7]=x_7;
 * T[0]=0, T[1]=0, T[2]=0, T[3]=0, T[4]=0, T[5]=0.
 * The output of Algorithm 3 can be explained as follows:
 * U[0]=y_19, U[1]=y_4, U[2]=y_2, U[3]=y_5, U[4]=y_14, U[5]=y_6, U[6]=y_21, U[7]=x_7;
 * T[0]=t_24, T[1]=t_37, T[2]=t_29, T[3]=t_40, T[4]=t_27, T[5]=t_33.
******/
void algorithm_3(int U[], int T[])
{
    U[0] = U[0] ^ U[6];               //U[0]=y_13
    U[6] = U[6] ^ U[2] ^ U[4] ^ U[5]; //U[6]=y_16
    T[0] = (U[0] & U[6]) ^ T[0];      //T[0]=t_7
    T[1] = T[1] ^ T[0];               //T[1]=t_7

    U[1] = U[1] ^ U[2] ^ U[7];               //U[1]=y_1
    U[2] = U[2] ^ U[1] ^ U[4] ^ U[5] ^ U[6]; //U[2]=y_5
    T[1] = (U[1] & U[2]) ^ T[1];             //T[1]=t_9

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3]; //U[0]=y_9
    U[6] = U[6] ^ U[1] ^ U[7];        //U[6]=y_11
    T[2] = (U[0] & U[6]) ^ T[2];      //T[2]=t_12
    T[3] = T[3] ^ T[2];               //T[3]=t_12

    U[5] = U[5] ^ U[3];                      //U[5]=y_14
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7]; //U[0]=y_17
    T[3] = (U[5] & U[0]) ^ T[3];             // T[3]=t_14
    T[1] = T[1] ^ T[3];                      //  T[1]=t_19

    U[0] = U[0] ^ U[3] ^ U[4]; //  U[0]=y_21
    T[1] = T[1] ^ U[0];        //  T[1]=t_23

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[6] ^ U[7]; //U[0]=y_2
    U[6] = U[6] ^ U[7];                      //U[6]=y_7
    T[0] = (U[0] & U[6]) ^ T[0];             //T[0]=t_11

    U[0] = U[0] ^ U[2] ^ U[5];        // U[0]=y_12
    U[5] = U[5] ^ U[0] ^ U[3] ^ U[4]; // U[5]=y_15
    T[4] = (U[0] & U[5]) ^ T[4];      // T[4]=t_2, ** first computation of t_2=U[0]& U[5]

    T[3] = T[3] ^ T[4];          // T[3]=t_19^t_2
    U[0] = U[0] ^ U[1] ^ U[3];   // U[0]=y_3
    U[5] = U[5] ^ U[7];          // U[5]=y_6
    T[3] = (U[0] & U[5]) ^ T[3]; // T[3]=t_19^t_4

    U[1] = U[1] ^ U[2] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_20
    T[3] = T[3] ^ U[1];                      //  T[3]=t_21

    U[1] = U[1] ^ U[2] ^ U[4] ^ U[6]; // U[1]=y_10
    U[0] = U[0] ^ U[2];               // U[0]=y_8
    T[2] = (U[1] & U[0]) ^ T[2];      // T[2]=t_16
    T[0] = T[0] ^ T[2];               // T[0]=t_20
    T[2] = T[2] ^ T[4];               // T[0]=t_16^t_2

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3] ^ U[5]; // U[0]=y_12
    U[5] = U[5] ^ U[7];                      // U[5]=y_15
    T[4] = (U[0] & U[5]) ^ T[4];             // T[4]=0, ** second computation of t_2=U[0]& U[5]

    // As shown in the above (with **), we need to compute t_2 two times.
    // If we introduce a new qubit (i.e. T[6]) to store t_2, we can save one Toffoli gate and one Toffoli depth.

    U[2] = U[2] ^ U[3] ^ U[4] ^ U[5] ^ U[6]; // U[2]=y_18
    T[0] = T[0] ^ U[2];                      // T[0]=t_24

    U[1] = U[1] ^ U[3] ^ U[5] ^ U[7]; // U[1]=y_4
    T[2] = (U[1] & U[7]) ^ T[2];      // T[2]=t_18

    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7]; // U[0]=y_19
    T[2] = T[2] ^ U[0];                      // T[2]=t_22

    T[4] = (T[1] & T[3]) ^ T[4]; // T[4]=t_26
    T[1] = T[1] ^ T[0];          // T[1]=t_30
    T[4] = T[4] ^ T[2];          // T[4]=t_31
    T[5] = (T[1] & T[4]) ^ T[5]; // T[5]=t_32
    T[5] = T[5] ^ T[0];          // T[5]=t_33
    T[1] = T[1] ^ T[0] ^ T[5];   // T[1]=t_34
    T[4] = T[4] ^ T[2] ^ T[0];   // T[4]=t_27
    T[5] = T[5] ^ T[4];          // T[5]=t_35
    T[1] = (T[0] & T[5]) ^ T[1]; // T[1]=t_37  *** first computation of t_36=T[0]& T[5]
    T[3] = T[3] ^ T[2];          // T[3]=t_25
    T[2] = (T[3] & T[4]) ^ T[2]; // T[2]=t_29
    T[4] = (T[0] & T[5]) ^ T[4]; // T[4]=t_38  *** second computation of t_36=T[0]& T[5]
    T[3] = (T[2] & T[4]) ^ T[3]; // T[3]=t_40
    T[4] = (T[0] & T[5]) ^ T[4]; // T[4]=t_27  *** third computation of t_36=T[0]& T[5]
    T[5] = T[5] ^ T[4];          // T[5]=t_33

    // As shown in the above (with ***), we need to compute t_36 three times.
    // If we introduce a new qubit (i.e. T[7]) to store t_36, we can save two Toffoli gate and two Toffoli depth.

    U[3] = U[3] ^ U[2] ^ U[4] ^ U[5] ^ U[6];        // U[3]=y_5
    U[4] = U[4] ^ U[0] ^ U[3] ^ U[7];               // U[4]=y_14
    U[2] = U[2] ^ U[6];                             // U[2]=y_2
    U[5] = U[5] ^ U[7];                             // U[5]=y_6
    U[6] = U[6] ^ U[0] ^ U[1] ^ U[3] ^ U[4] ^ U[5]; // U[6]=y_21
}

/******
 * The input of Algorithm 5 can be explained as follows:
 * U[0]=y_19, U[1]=y_4, U[2]=y_2, U[3]=y_5, U[4]=y_14, U[5]=y_6, U[6]=y_21, U[7]=x_7;
 * T[0]=t_24, T[1]=t_37, T[2]=t_29, T[3]=t_40, T[4]=t_27, T[5]=t_33;
 * S[0]=0, S[1]=0, S[2]=0, S[3]=0, S[4]=0, S[5]=0, S[6]=0, S[7]=0.
 * The output of Algorithm 5 can be explained as follows:
 * U[0]=x_0, U[1]=x_1, U[2]=x_2, U[3]=x_3, U[4]=x_4, U[5]=x_5, U[6]=x_6, U[7]=x_7;
 * T[0]=0, T[1]=0, T[2]=0, T[3]=0, T[4]=0, T[5]=0;
 * S[0]=s_0, S[1]=s_1, S[2]=s_2, S[3]=s_3, S[4]=s_4, S[5]=s_5, S[6]=s_6, S[7]=s_7.
******/
void algorithm_5(int U[], int T[], int S[], int Z, int j)
{
    /*** This part is used to generate the output of S-box, the result is stored in S[] ***/
    U[5] = U[5] ^ U[7]; // U[5]=y_15
    T[1] = T[1] ^ T[5]; // T[1]=t_44

    Z = (T[1] & U[5]) ^ Z; // T[1]& U[5]=z_0 and Z=z_0
    S[1] = S[1] ^ Z;       // S[1]=z_0
    S[2] = S[2] ^ Z;       // S[2]=z_0
    S[3] = S[3] ^ Z;       // S[3]=z_0
    S[5] = S[5] ^ Z;       // S[5]=z_0
    S[7] = S[7] ^ Z;       // S[7]=z_0
    Z = (T[1] & U[5]) ^ Z; // Z=0

    U[5] = U[5] ^ U[7]; // U[5]=y_6
    T[1] = T[1] ^ T[5]; // T[1]=t_37

    // S[0]=0,  S[1]=z_0,   S[2]=z_0,   S[3]=z_0,
    // S[4]=0,  S[5]=z_0,   S[6]=0,      S[7]=z_0,

    Z = (T[1] & U[5]) ^ Z; //  T[1]& U[5]=z_1  and Z=z_1
    S[1] = S[1] ^ Z;       //  S[1]=z_0^z_1
    S[3] = S[3] ^ Z;       //  S[3]=z_0^z_1
    S[4] = S[4] ^ Z;       // S[4]=z_1
    Z = (T[1] & U[5]) ^ Z; //Z=0

    // S[0]=0,     S[1]=z_0^z_1,   S[2]=z_0,   S[3]=z_0^z_1,
    // S[4]=z_1,  S[5]=z_0,   S[6]=0,      S[7]=z_0,

    Z = (T[5] & U[7]) ^ Z; // T[5]& U[7]=z_2 and Z=z_2
    S[2] = S[2] ^ Z;       // S[2]=z_0^z_2
    S[4] = S[4] ^ Z;       // S[4]=z_1^z_2
    S[5] = S[5] ^ Z;       // S[5]=z_0^z_2
    S[7] = S[7] ^ Z;       //S[7]=z_0^z_2
    Z = (T[5] & U[7]) ^ Z; //  Z=0

    // S[0]=0,     S[1]=z_0^z_1,   S[2]=z_0^z_2,   S[3]=z_0^z_1,
    // S[4]=z_1^z_2,  S[5]=z_0^z_2,   S[6]=0,      S[7]=z_0^z_2,

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_16
    T[3] = T[3] ^ T[2];        // T[3]=t_43

    Z = (T[3] & U[6]) ^ Z; // T[3]& U[6]=z_3 and Z=z_3
    S[0] = S[0] ^ Z;       // S[0]=z_3
    S[3] = S[3] ^ Z;       // S[3]=z_0^z_1^z_3
    S[5] = S[5] ^ Z;       // S[5]=z_0^z_2^z_3
    S[7] = S[7] ^ Z;       // S[7]=z_0^z_2^z_3
    Z = (T[3] & U[6]) ^ Z; //  Z=0

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_21
    T[3] = T[3] ^ T[2];        // T[3]=t_40

    // S[0]=z_3,     S[1]=z_0^z_1,   S[2]=z_0^z_2,   S[3]=z_0^z_1^z_3,
    // S[4]=z_1^z_2,  S[5]=z_0^z_2^z_3,   S[6]=0,      S[7]=z_0^z_2^z_3,

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_1

    Z = (T[3] & U[1]) ^ Z;                   // T[3]& U[1]=z_4 and Z=z_4
    S[0] = S[0] ^ Z;                         // S[0]=z_3^z_4
    S[3] = S[3] ^ Z;                         // S[3]=z_0^z_1^z_3^z_4
    S[4] = S[4] ^ Z;                         // S[4]=z_1^z_2^z_4
    S[5] = S[5] ^ Z;                         // S[5]=z_0^z_2^z_3^z_4
    S[6] = S[6] ^ Z;                         // S[6]=z_4
    Z = (T[3] & U[1]) ^ Z;                   //  Z=0
    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_4

    // S[0]=z_3^z_4,     S[1]=z_0^z_1,   S[2]=z_0^z_2,   S[3]=z_0^z_1^z_3^z_4,
    // S[4]=z_1^z_2^z_4,  S[5]=z_0^z_2^z_3^z_4,   S[6]=z_4,      S[7]=z_0^z_2^z_3,

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_7

    Z = (T[2] & U[1]) ^ Z; // T[2]& U[1]=z_5 and Z=z_5
    S[4] = S[4] ^ Z;       // S[4]=z_1^z_2^z_4^z_5
    S[6] = S[6] ^ Z;       // S[6]=z_4^z_5
    S[7] = S[7] ^ Z;       // S[7]=z_0^z_2^z_3^z_5
    Z = (T[2] & U[1]) ^ Z; //  Z=0

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_4

    // S[0]=z_3^z_4,     S[1]=z_0^z_1,   S[2]=z_0^z_2,   S[3]=z_0^z_1^z_3^z_4,
    // S[4]=z_1^z_2^z_4^z_5,  S[5]=z_0^z_2^z_3^z_4,   S[6]=z_4^z_5,      S[7]=z_0^z_2^z_3^z_5,

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_11
    T[5] = T[5] ^ T[2];                                    // T[5]=t_42

    Z = (T[5] & U[3]) ^ Z; // T[5]& U[3]=z_6 and Z=z_6
    S[0] = S[0] ^ Z;       // S[0]=z_3^z_4^z_6
    S[1] = S[1] ^ Z;       // S[1]=z_0^z_1^z_6
    S[2] = S[2] ^ Z;       // S[2]=z_0^z_2^z_6
    Z = (T[5] & U[3]) ^ Z; //  Z=0

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_5
    T[5] = T[5] ^ T[2];                                    // T[5]=t_33

    // S[0]=z_3^z_4^z_6,     S[1]=z_0^z_1^z_6,   S[2]=z_0^z_2^z_6,   S[3]=z_0^z_1^z_3^z_4,
    // S[4]=z_1^z_2^z_4^z_5,  S[5]=z_0^z_2^z_3^z_4,   S[6]=z_4^z_5,      S[7]=z_0^z_2^z_3^z_5,

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_17
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_45

    Z = (T[5] & U[3]) ^ Z; // T[5]& U[3]=z_7 and Z=z_7
    S[0] = S[0] ^ Z;       //S[0]=z_3^z_4^z_6^z_7
    S[1] = S[1] ^ Z;       // S[1]=z_0^z_1^z_6^z_7
    S[5] = S[5] ^ Z;       // S[5]=z_0^z_2^z_3^z_4^z_7
    S[6] = S[6] ^ Z;       // S[6]=z_4^z_5^z_7
    Z = (T[5] & U[3]) ^ Z; //  Z=0

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_5
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7,     S[1]=z_0^z_1^z_6^z_7,   S[2]=z_0^z_2^z_6,   S[3]=z_0^z_1^z_3^z_4,
    // S[4]=z_1^z_2^z_4^z_5,  S[5]=z_0^z_2^z_3^z_4^z_7,   S[6]=z_4^z_5^z_7,      S[7]=z_0^z_2^z_3^z_5,

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_10
    T[3] = T[3] ^ T[1];               // T[3]=t_41

    Z = (T[3] & U[1]) ^ Z; //  T[3]& U[1]=z_8 and Z=z_8
    S[2] = S[2] ^ Z;       // S[2]=z_0^z_2^z_6^z_8
    S[5] = S[5] ^ Z;       // S[5]=z_0^z_2^z_3^z_4^z_7^z_8
    S[6] = S[6] ^ Z;       //  S[6]=z_4^z_5^z_7^z_8
    Z = (T[3] & U[1]) ^ Z; //  Z=0

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];               // T[3]=t_33

    // S[0]=z_3^z_4^z_6^z_7,     S[1]=z_0^z_1^z_6^z_7,   S[2]=z_0^z_2^z_6^z_8,   S[3]=z_0^z_1^z_3^z_4,
    // S[4]=z_1^z_2^z_4^z_5,  S[5]=z_0^z_2^z_3^z_4^z_7^z_8,   S[6]=z_4^z_5^z_7^z_8,      S[7]=z_0^z_2^z_3^z_5,

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_12
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    Z = (T[5] & U[2]) ^ Z; // T[5]& U[2]=z_9 and Z=z_9
    S[0] = S[0] ^ Z;       // S[0]=z_3^z_4^z_6^z_7^z_9
    S[1] = S[1] ^ Z;       //  S[1]=z_0^z_1^z_6^z_7^z_9
    S[3] = S[3] ^ Z;       //  S[3]=z_0^z_1^z_3^z_4^z_9
    S[4] = S[4] ^ Z;       //  S[4]=z_1^z_2^z_4^z_5^z_9
    Z = (T[5] & U[2]) ^ Z; //  Z=0

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_2
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9,     S[1]=z_0^z_1^z_6^z_7^z_9,   S[2]=z_0^z_2^z_6^z_8,   S[3]=z_0^z_1^z_3^z_4^z_9,
    // S[4]=z_1^z_2^z_4^z_5^z_9,  S[5]=z_0^z_2^z_3^z_4^z_7^z_8,   S[6]=z_4^z_5^z_7^z_8,      S[7]=z_0^z_2^z_3^z_5,

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_3

    Z = (T[1] & U[1]) ^ Z; // T[1]& U[1]=z_10 and Z=z_10
    S[0] = S[0] ^ Z;       // S[0]=z_3^z_4^z_6^z_7^z_9^z_10
    S[1] = S[1] ^ Z;       // S[1]=z_0^z_1^z_6^z_7^z_9^z_10
    S[3] = S[3] ^ Z;       // S[3]=z_0^z_1^z_3^z_4^z_9^z_10
    S[4] = S[4] ^ Z;       // S[4]=z_1^z_2^z_4^z_5^z_9^z_10
    S[5] = S[5] ^ Z;       // S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10
    Z = (T[1] & U[1]) ^ Z; //  Z=0

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_4

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10,     S[1]=z_0^z_1^z_6^z_7^z_9^z_10,   S[2]=z_0^z_2^z_6^z_8,   S[3]=z_0^z_1^z_3^z_4^z_9^z_10,
    // S[4]=z_1^z_2^z_4^z_5^z_9^z_10,  S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10,   S[6]=z_4^z_5^z_7^z_8,      S[7]=z_0^z_2^z_3^z_5,

    U[2] = U[2] ^ U[3]; // U[2]=y_13
    T[3] = T[3] ^ T[2]; // T[3]=t_43

    Z = (T[3] & U[2]) ^ Z; // T[3]& U[2]=z_12 and Z=z_12

    S[2] = S[2] ^ Z; // S[2]=z_0^z_2^z_6^z_8^z_12
    S[5] = S[5] ^ Z; // S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12
    S[6] = S[6] ^ Z; // S[6]=z_4^z_5^z_7^z_8^z_12
    S[7] = S[7] ^ Z; // S[7]=z_0^z_2^z_3^z_5^z_12

    Z = (T[3] & U[2]) ^ Z; //  Z=0

    U[2] = U[2] ^ U[3]; // U[2]=y_2
    T[3] = T[3] ^ T[2]; // T[3]=t_40

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10,     S[1]=z_0^z_1^z_6^z_7^z_9^z_10,   S[2]=z_0^z_2^z_6^z_8^z_12,   S[3]=z_0^z_1^z_3^z_4^z_9^z_10,
    // S[4]=z_1^z_2^z_4^z_5^z_9^z_10,  S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12,   S[6]=z_4^z_5^z_7^z_8^z_12,      S[7]=z_0^z_2^z_3^z_5^z_12,

    Z = (T[3] & U[3]) ^ Z; //T[3]& U[3]=z_13 and Z=z_13
    S[6] = S[6] ^ Z;       //S[6]=z_4^z_5^z_7^z_8^z_12^z_13
    S[7] = S[7] ^ Z;       //S[7]=z_0^z_2^z_3^z_5^z_12^z_13
    Z = (T[3] & U[3]) ^ Z; // Z=0

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10,     S[1]=z_0^z_1^z_6^z_7^z_9^z_10,   S[2]=z_0^z_2^z_6^z_8^z_12,   S[3]=z_0^z_1^z_3^z_4^z_9^z_10,
    // S[4]=z_1^z_2^z_4^z_5^z_9^z_10,  S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12,   S[6]=z_4^z_5^z_7^z_8^z_12^z_13,      S[7]=z_0^z_2^z_3^z_5^z_12^z_13,

    Z = (T[2] & U[2]) ^ Z; // T[2]& U[2]=z_14 and Z=z_14
    S[2] = S[2] ^ Z;       // S[2]=z_0^z_2^z_6^z_8^z_12^z_14
    S[5] = S[5] ^ Z;       //S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14
    Z = (T[2] & U[2]) ^ Z; //  Z=0

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10,     S[1]=z_0^z_1^z_6^z_7^z_9^z_10,   S[2]=z_0^z_2^z_6^z_8^z_12^z_14,   S[3]=z_0^z_1^z_3^z_4^z_9^z_10,
    // S[4]=z_1^z_2^z_4^z_5^z_9^z_10,  S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14,   S[6]=z_4^z_5^z_7^z_8^z_12^z_13,      S[7]=z_0^z_2^z_3^z_5^z_12^z_13,

    U[1] = U[1] ^ U[2]; // U[1]=y_9
    T[5] = T[5] ^ T[2]; // T[5]=t_42

    Z = (T[5] & U[1]) ^ Z; // T[5]& U[1]=z_15 and Z=z_15
    S[0] = S[0] ^ Z;       // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15
    S[1] = S[1] ^ Z;       // S[1]=z_0^z_1^z_6^z_7^z_9^z_10^z_15
    S[2] = S[2] ^ Z;       //S[2]=z_0^z_2^z_6^z_8^z_12^z_14^z_15
    S[3] = S[3] ^ Z;       // S[3]=z_0^z_1^z_3^z_4^z_9^z_10^z_15
    S[4] = S[4] ^ Z;       //S[4]=z_1^z_2^z_4^z_5^z_9^z_10^z_15
    S[5] = S[5] ^ Z;       //S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14^z_15
    S[6] = S[6] ^ Z;       // S[6]=z_4^z_5^z_7^z_8^z_12^z_13^z_15
    S[7] = S[7] ^ Z;       //S[7]=z_0^z_2^z_3^z_5^z_12^z_13^z_15
    Z = (T[5] & U[1]) ^ Z; // Z=0

    U[1] = U[1] ^ U[2]; // U[1]=y_4
    T[5] = T[5] ^ T[2]; // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15,     S[1]=z_0^z_1^z_6^z_7^z_9^z_10^z_15,
    //S[2]=z_0^z_2^z_6^z_8^z_12^z_14^z_15,   S[3]=z_0^z_1^z_3^z_4^z_9^z_10^z_15,
    // S[4]=z_1^z_2^z_4^z_5^z_9^z_10^z_15,  S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14^z_15,
    //S[6]=z_4^z_5^z_7^z_8^z_12^z_13^z_15,      S[7]=z_0^z_2^z_3^z_5^z_12^z_13^z_15,

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_45

    Z = (T[5] & U[4]) ^ Z; // T[5]& U[4]=z_16 and Z=z_16
    S[0] = S[0] ^ Z;       // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15 ^z_16
    S[1] = S[1] ^ Z;       // S[1]=z_0^z_1^z_6^z_7^z_9^z_10^z_15^z_16
    S[3] = S[3] ^ Z;       // S[3]=z_0^z_1^z_3^z_4^z_9^z_10^z_15^z_16
    S[4] = S[4] ^ Z;       //S[4]=z_1^z_2^z_4^z_5^z_9^z_10^z_15^z_16
    S[5] = S[5] ^ Z;       //S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14^z_15^z_16
    S[6] = S[6] ^ Z;       // S[6]=z_4^z_5^z_7^z_8^z_12^z_13^z_15^z_16
    S[7] = S[7] ^ Z;       //S[7]=z_0^z_2^z_3^z_5^z_12^z_13^z_15^z_16
    Z = (T[5] & U[1]) ^ Z; // Z=0

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_33

    //S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15 ^z_16 ,   S[1]=z_0^z_1^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_0^z_2^z_6^z_8^z_12^z_14^z_15,
    // S[3]=z_0^z_1^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_4^z_5^z_9^z_10^z_15^z_16,      S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14^z_15^z_16 ,
    // S[6]=z_4^z_5^z_7^z_8^z_12^z_13^z_15^z_16,  S[7]=z_0^z_2^z_3^z_5^z_12^z_13^z_15^z_16,

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_8
    T[3] = T[3] ^ T[1];        // T[3]=t_41

    S[2] = (T[3] & U[1]) ^ S[2]; // T[3]& U[1]=z_17 and S[2]=z_0^z_2^z_6^z_8^z_12^z_14^z_15^z_17

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];        // T[3]=t_40

    //S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15 ^z_16 ,   S[1]=z_0^z_1^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_0^z_2^z_6^z_8^z_12^z_14^z_15^z_17,
    // S[3]=z_0^z_1^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_4^z_5^z_9^z_10^z_15^z_16,      S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14^z_15^z_16 ,
    // S[6]=z_4^z_5^z_7^z_8^z_12^z_13^z_15^z_16,  S[7]=z_0^z_2^z_3^z_5^z_12^z_13^z_15^z_16,

    S[5] = (T[5] & U[1]) ^ S[5]; //  T[5]& U[1]=z_11 and S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_12^z_14^z_15^z_16^z_11

    //S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15 ^z_16 ,   S[1]=z_0^z_1^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_0^z_2^z_6^z_8^z_12^z_14^z_15^z_17,
    // S[3]=z_0^z_1^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_4^z_5^z_9^z_10^z_15^z_16,   S[5]=z_0^z_2^z_3^z_4^z_7^z_8^z_10^z_11^z_12^z_14^z_15^z_16 ,
    // S[6]=z_4^z_5^z_7^z_8^z_12^z_13^z_15^z_16,  S[7]=z_0^z_2^z_3^z_5^z_12^z_13^z_15^z_16,

    j = 1 ^ S[1];
    S[1] = j;

    j = 1 ^ S[2];
    S[2] = j;

    j = 1 ^ S[6];
    S[6] = j;

    j = 1 ^ S[7];
    S[7] = j;

    /*** This part is used to generate the input of S-box, the result is stored in U[] ***/
    U[6] = U[6] ^ U[0] ^ U[1] ^ U[3] ^ U[4] ^ U[5];
    U[5] = U[5] ^ U[7];
    U[2] = U[2] ^ U[6];
    U[4] = U[4] ^ U[0] ^ U[3] ^ U[7];
    U[3] = U[3] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[5] = T[5] ^ T[4];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[3] = (T[2] & T[4]) ^ T[3];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[2] = (T[3] & T[4]) ^ T[2];
    T[3] = T[3] ^ T[2];
    T[1] = (T[0] & T[5]) ^ T[1];
    T[5] = T[5] ^ T[4];

    T[4] = T[4] ^ T[2] ^ T[0];
    T[1] = T[1] ^ T[0] ^ T[5];
    T[5] = T[5] ^ T[0];
    T[5] = (T[1] & T[4]) ^ T[5];
    T[4] = T[4] ^ T[2];
    T[1] = T[1] ^ T[0];
    T[4] = (T[1] & T[3]) ^ T[4];

    T[2] = T[2] ^ U[0];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];

    T[2] = (U[1] & U[7]) ^ T[2];
    U[1] = U[1] ^ U[3] ^ U[5] ^ U[7];

    T[0] = T[0] ^ U[2];
    U[2] = U[2] ^ U[3] ^ U[4] ^ U[5] ^ U[6];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3] ^ U[5];

    T[2] = T[2] ^ T[4];
    T[0] = T[0] ^ T[2];
    T[2] = (U[1] & U[0]) ^ T[2];
    U[0] = U[0] ^ U[2];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[6];

    T[3] = T[3] ^ U[1];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[3] = (U[0] & U[5]) ^ T[3];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[3];
    T[3] = T[3] ^ T[4];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[0] ^ U[3] ^ U[4];
    U[0] = U[0] ^ U[2] ^ U[5];

    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[6] ^ U[7];

    T[1] = T[1] ^ U[0];
    U[0] = U[0] ^ U[3] ^ U[4];

    T[1] = T[1] ^ T[3];
    T[3] = (U[5] & U[0]) ^ T[3];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];
    U[5] = U[5] ^ U[3];

    T[3] = T[3] ^ T[2];
    T[2] = (U[0] & U[6]) ^ T[2];
    U[6] = U[6] ^ U[1] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3];

    T[1] = (U[1] & U[2]) ^ T[1];
    U[2] = U[2] ^ U[1] ^ U[4] ^ U[5] ^ U[6];
    U[1] = U[1] ^ U[2] ^ U[7];

    T[1] = T[1] ^ T[0];
    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[2] ^ U[4] ^ U[5];
    U[0] = U[0] ^ U[6];
}

int main()
{
    int U[8], T[6], S[8], Z, j, X, ii, input, output;

    for (X = 0; X < 256; ++X)
    {
        for (ii = 0; ii < 6; ++ii)
            T[ii] = 0;
        for (ii = 0; ii < 8; ++ii)
            U[ii] = (X >> (7 - ii)) & 1;
        //algorithm 3
        algorithm_3(U, T);

        //algorithm 5
        for (ii = 0; ii < 8; ++ii)
            S[ii] = 0;
        algorithm_5(U, T, S, Z, j);

        for (input = 0, output = 0, ii = 0; ii < 8; ++ii)
        {
            input = (input << 1) | U[ii];
            output = (output << 1) | S[ii];
        }
        printf("%02X: %02X  ", input, output);
        if (X % 16 == 15)
            printf("\n");
    }
}