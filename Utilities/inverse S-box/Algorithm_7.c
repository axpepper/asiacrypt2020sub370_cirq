#include <stdio.h>
#include <stdlib.h>

/******
 * The input of Algorithm 6 can be explained as follows:
 * U[0]=x_0, U[1]=x_1, U[2]=x_2, U[3]=x_3, U[4]=x_4, U[5]=x_5, U[6]=x_6, U[7]=x_7;
 * T[0]=0, T[1]=0, T[2]=0, T[3]=0, T[4]=0, T[5]=0.
 * The output of Algorithm 6 can be explained as follows:
 * U[0]=y_7, U[1]=y_5, U[2]=y_4, U[3]=y_6, U[4]=y_1, U[5]=y_2, U[6]=y_0, U[7]=y_3;
 * T[0]=t_29, T[1]=t_40, T[2]=t_33, T[3]=t_34, T[4]=t_37, T[5]=t_35.
******/
void algorithm_6(int U[], int T[], int i, int j)
{
    i = U[7] ^ U[3];
    j = 1 ^ i;
    U[7] = j;                                       // U[7]=y_15
    U[6] = U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[1] ^ U[0]; // U[6]=y_14
    T[0] = (U[6] & U[7]) ^ T[0];                    // T[0]=t_5
    T[2] = T[2] ^ T[0];                             // T[2]=t_5

    i = U[5] ^ U[3] ^ U[2];
    j = 1 ^ i;
    U[5] = j;                                              // U[5]=y_17
    U[7] = U[7] ^ U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[2] ^ U[1]; // U[7]=y_16
    T[0] = (U[5] & U[7]) ^ T[0];                           // T[0]=t_5 ^ t_3
    T[1] = T[1] ^ T[0];                                    // T[1]=t_5 ^ t_3

    i = U[7] ^ U[2] ^ U[0];
    j = 1 ^ i;
    U[7] = j; // U[7]=y_9

    i = U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[2] ^ U[0];
    j = 1 ^ i;
    U[6] = j;                    // U[6]=y_8
    T[2] = (U[6] & U[7]) ^ T[2]; // T[2]=t_5 ^ t_9
    T[3] = T[3] ^ T[2];          // T[3]=t_5 ^ t_9

    U[5] = U[5] ^ U[6] ^ U[2] ^ U[1];                      // U[5]=y_13
    U[7] = U[7] ^ U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[2] ^ U[1]; // U[7]=y_12
    T[0] = (U[5] & U[7]) ^ T[0];                           // T[0]=t_5 ^ t_3 ^ t_6  ** first computation of t_6= U[5]& U[7]
    T[2] = (U[5] & U[7]) ^ T[2];                           // T[2]=t_5 ^ t_9 ^ t_6  ** second computation of t_6= U[5]& U[7]

    // As shown in the above (with **), we need to compute t_6 two times.
    // If we introduce a new qubit (i.e. T[6]) to store t_6, we can save one Toffoli gate and one Toffoli depth.

    U[7] = U[7] ^ U[3] ^ U[4]; // U[7]=y_11

    i = U[5] ^ U[7] ^ U[1] ^ U[0];
    j = 1 ^ i;
    U[5] = j; // U[5]=y_10

    T[1] = (U[5] & U[7]) ^ T[1]; // T[1]=t_5 ^ t_3 ^ t_7  ** first computation of t_7= U[5]& U[7]
    T[3] = (U[5] & U[7]) ^ T[3]; // T[3]=t_5 ^ t_9 ^ t_7  ** second computation of t_7= U[5]& U[7]

    // As shown in the above (with **), we need to compute t_7 two times.
    // If we introduce a new qubit (i.e. T[7]) to store t_7, we can save one Toffoli gate and one Toffoli depth.

    U[5] = U[5] ^ U[6] ^ U[3] ^ U[0];        // U[5]=y_7
    U[7] = U[7] ^ U[5] ^ U[2] ^ U[1] ^ U[0]; // U[7]=y_3
    T[0] = (U[5] & U[7]) ^ T[0];             // T[0]=t_5 ^ t_3 ^ t_6 ^ t_2 =t_18 ^ y_21

    i = U[7] ^ U[5] ^ U[3] ^ U[1] ^ U[0];
    j = 1 ^ i;
    U[7] = j; // U[7]=y_6

    i = U[1] ^ U[7];
    j = 1 ^ i;
    U[1] = j; // U[1]=y_2

    T[1] = (U[7] & U[1]) ^ T[1]; // T[1]=t_5 ^ t_3 ^ t_7 ^ t_4 =t_20 ^ y_20

    U[1] = U[1] ^ U[7] ^ U[6] ^ U[3]; // U[1]=y_5

    i = U[4] ^ U[3] ^ U[2] ^ U[1];
    j = 1 ^ i;
    U[4] = j; // U[4]=y_1

    T[2] = (U[1] & U[4]) ^ T[2]; // T[2]=t_5 ^ t_9 ^ t_6 ^ t_8 =t_22 ^ y_19

    i = U[5] ^ U[3] ^ U[2] ^ U[1];
    j = 1 ^ i;
    U[5] = j; // U[5]=y_4

    U[6] = U[6] ^ U[4];          // U[6]=y_0
    T[3] = (U[6] & U[5]) ^ T[3]; // T[3]=t_5 ^ t_9 ^ t_7 ^ t_10 =t_24 ^ y_18

    U[7] = U[7] ^ U[3] ^ U[4] ^ U[1] ^ U[0]; // U[7]=y_21
    T[0] = T[0] ^ U[7];                      // T[0]=t_18

    U[5] = U[5] ^ U[3]; // U[5]=y_20
    T[1] = T[1] ^ U[5]; // T[1]=t_20

    U[7] = U[7] ^ U[4] ^ U[1]; // U[7]=y_19
    T[2] = T[2] ^ U[7];        // T[2]=t_22

    U[6] = U[6] ^ U[3] ^ U[4] ^ U[1]; // U[6]=y_18
    T[3] = T[3] ^ U[6];               // T[3]=t_24

    T[4] = (T[1] & T[3]) ^ T[4]; // T[4]=t_26   ** first computation of t_26= T[1]& T[3]
    T[3] = T[3] ^ T[2];          // T[3]=t_30
    T[4] = T[4] ^ T[0];          // T[4]=t_31
    T[5] = T[5] ^ T[2];          // T[5]=t_22
    T[5] = (T[3] & T[4]) ^ T[5]; // T[5]=t_33
    T[4] = T[4] ^ T[0];          // T[4]=t_26,  we do not count this t_26, because we do not need Toffoli gate here.
    T[4] = T[4] ^ T[2];          // T[4]=t_27

    T[3] = T[3] ^ T[2]; // T[3]=t_24
    T[5] = T[5] ^ T[4]; // T[5]=t_35

    T[4] = (T[5] & T[2]) ^ T[4]; // T[4]=t_38
    T[2] = (T[1] & T[3]) ^ T[2]; // T[2]=t_27   ** second computation of t_26= T[1]& T[3]

    // As shown in the above (with **), we need to compute t_26 two times.
    // If we introduce a new qubit (i.e. T[8]) to store t_26, we can save one Toffoli gate and one Toffoli depth.

    T[1] = T[0] ^ T[1];          // T[1]=t_25
    T[0] = (T[1] & T[2]) ^ T[0]; // T[0]=t_29
    T[1] = (T[0] & T[4]) ^ T[1]; // T[1]=t_40

    T[4] = T[4] ^ T[2]; // T[4]=t_36
    T[2] = T[2] ^ T[5]; // T[2]=t_33
    T[3] = T[3] ^ T[2]; // T[3]=t_34
    T[4] = T[4] ^ T[3]; // T[4]=t_37

    i = U[7] ^ U[6] ^ U[5] ^ U[2] ^ U[1];
    j = 1 ^ i;
    U[7] = j; // U[7]=y_3

    i = U[5] ^ U[7] ^ U[3] ^ U[2] ^ U[1] ^ U[0];
    j = 1 ^ i;
    U[5] = j; // U[5]=y_2

    U[6] = U[6] ^ U[3] ^ U[4] ^ U[1];        //  U[6]=y_0
    U[0] = U[0] ^ U[5] ^ U[3] ^ U[7];        //  U[0]=y_7
    U[3] = U[6] ^ U[5] ^ U[3] ^ U[4] ^ U[1]; //  U[3]=y_6

    i = U[6] ^ U[5] ^ U[3] ^ U[4] ^ U[2] ^ U[0];
    j = 1 ^ i;
    U[2] = j; // U[2]=y_4
}

/******
 * The input of Algorithm 7 can be explained as follows:
 * U[0]=y_7, U[1]=y_5, U[2]=y_4, U[3]=y_6, U[4]=y_1, U[5]=y_2, U[6]=y_0, U[7]=y_3;
 * T[0]=t_29, T[1]=t_40, T[2]=t_33, T[3]=t_34, T[4]=t_37, T[5]=t_35;
 * S[0]=0, S[1]=0, S[2]=0, S[3]=0, S[4]=0, S[5]=0, S[6]=0, S[7]=0.
 * The output of Algorithm 4 can be explained as follows:
 * U[0]=x_0, U[1]=x_1, U[2]=x_2, U[3]=x_3, U[4]=x_4, U[5]=x_5, U[6]=x_6, U[7]=x_7;
 * T[0]=0, T[1]=0, T[2]=0, T[3]=0, T[4]=0, T[5]=0;
 * S[0]=s_0, S[1]=s_1, S[2]=s_2, S[3]=s_3, S[4]=s_4, S[5]=s_5, S[6]=s_6, S[7]=s_7.
******/
void algorithm_7(int U[], int T[], int S[], int Z, int i, int j)
{
    /*** This part is used to generate the output of S-box, the result is stored in S[] ***/
    Z = (T[1] & U[2]) ^ Z; // Z=z_0
    S[0] = S[0] ^ Z;       // S[0]=z_0
    S[6] = S[6] ^ Z;       // S[6]=z_0
    Z = (T[1] & U[2]) ^ Z; // Z=0

    // S[0]=z_0,  S[1]=0,  S[2]=0,     S[3]=0,
    // S[4]=0,    S[5]=0,  S[6]=z_0,   S[7]=0,

    T[0] = T[0] ^ T[1];    // T[0]=t_45
    U[2] = U[2] ^ U[1];    // U[2]=y_9
    Z = (T[0] & U[2]) ^ Z; // Z= z_1
    S[1] = S[1] ^ Z;       // S[1]=z_1
    S[3] = S[3] ^ Z;       // S[3]=z_1
    S[6] = S[6] ^ Z;       // S[6]=z_0^z_1
    Z = (T[0] & U[2]) ^ Z; // Z= 0
    T[0] = T[0] ^ T[1];    // T[0]=t_29
    U[2] = U[2] ^ U[1];    // U[2]=y_4

    // S[0]=z_0,  S[1]=z_1,  S[2]=0,        S[3]=z_1,
    // S[4]=0,    S[5]=0,    S[6]=z_0^z_1,  S[7]=0,

    Z = (T[0] & U[1]) ^ Z; // Z=z_2
    S[0] = S[0] ^ Z;       // S[0]=z_0^z_2
    S[1] = S[1] ^ Z;       // S[1]=z_1^z_2
    S[3] = S[3] ^ Z;       // S[3]=z_1^z_2
    Z = (T[0] & U[1]) ^ Z; // Z=0

    // S[0]=z_0^z_2,  S[1]=z_1^z_2,  S[2]=0,        S[3]=z_1^z_2,
    // S[4]=0,        S[5]=0,        S[6]=z_0^z_1,  S[7]=0,

    T[4] = T[4] ^ T[1] ^ T[0] ^ T[2]; // T[4]=t_44
    U[2] = U[2] ^ U[3] ^ U[1] ^ U[0]; // U[2]=y_11
    Z = (T[4] & U[2]) ^ Z;            // Z=z_3

    S[0] = S[0] ^ Z; // S[0]=z_0^z_2^z_3
    S[2] = S[2] ^ Z; // S[2]=z_3
    S[3] = S[3] ^ Z; // S[3]=z_1^z_2^z_3
    S[5] = S[5] ^ Z; // S[5]=z_3
    S[6] = S[6] ^ Z; // S[6]=z_0^z_1^z_3
    S[7] = S[7] ^ Z; // S[7]=z_3

    Z = (T[4] & U[2]) ^ Z;            // Z=0
    T[4] = T[4] ^ T[1] ^ T[0] ^ T[2]; // T[4]=t_37
    U[2] = U[2] ^ U[3] ^ U[1] ^ U[0]; // U[2]=y_4

    // S[0]=z_0^z_2^z_3,  S[1]=z_1^z_2,    S[2]=z_3,          S[3]=z_1^z_2^z_3,
    // S[4]=0,            S[5]=z_3,        S[6]=z_0^z_1^z_3,  S[7]=z_3,

    T[0] = T[0] ^ T[2];    // T[0]=t_42
    U[1] = U[1] ^ U[0];    // U[1]=y_15
    Z = (T[0] & U[1]) ^ Z; // Z=z_4

    S[1] = S[1] ^ Z; // S[1]=z_1^z_2^z_4
    S[6] = S[6] ^ Z; // S[6]=z_0^z_1^z_3^z_4

    Z = (T[0] & U[1]) ^ Z; // Z=0
    T[0] = T[0] ^ T[2];    // T[0]=t_29
    U[1] = U[1] ^ U[0];    // U[1]=y_5

    // S[0]=z_0^z_2^z_3,  S[1]=z_1^z_2^z_4,  S[2]=z_3,              S[3]=z_1^z_2^z_3,
    // S[4]=0,            S[5]=z_3,          S[6]=z_0^z_1^z_3^z_4,  S[7]=z_3,

    T[4] = T[4] ^ T[1];    // T[4]=t_43
    U[3] = U[3] ^ U[2];    // U[3]=y_13
    Z = (T[4] & U[3]) ^ Z; // Z=z_5

    S[0] = S[0] ^ Z; // S[0]=z_0^z_2^z_3^z_5
    S[1] = S[1] ^ Z; // S[1]=z_1^z_2^z_4^z_5
    S[2] = S[2] ^ Z; // S[2]=z_3^z_5
    S[3] = S[3] ^ Z; // S[3]=z_1^z_2^z_3^z_5
    S[5] = S[5] ^ Z; // S[5]=z_3^z_5
    S[7] = S[7] ^ Z; // S[7]=z_3^z_5

    Z = (T[4] & U[3]) ^ Z; // Z=0
    T[4] = T[4] ^ T[1];    // T[4]=t_37
    U[3] = U[3] ^ U[2];    // U[3]=y_6
                           // S[0]=z_0^z_2^z_3^z_5,  S[1]=z_1^z_2^z_4^z_5,  S[2]=z_3^z_5,          S[3]=z_1^z_2^z_3^z_5,
                           // S[4]=0,                S[5]=z_3^z_5,          S[6]=z_0^z_1^z_3^z_4,  S[7]=z_3^z_5,

    Z = (T[4] & U[3]) ^ Z; // Z=z_6
    S[2] = S[2] ^ Z;       // S[2]=z_3^z_5^z_6
    S[3] = S[3] ^ Z;       // S[3]=z_1^z_2^z_3^z_5^z_6
    S[5] = S[5] ^ Z;       // S[5]=z_3^z_5^z_6
    S[7] = S[7] ^ Z;       // S[7]=z_3^z_5^z_6
    Z = (T[4] & U[3]) ^ Z; // Z=0
                           // S[0]=z_0^z_2^z_3^z_5,  S[1]=z_1^z_2^z_4^z_5,  S[2]=z_3^z_5^z_6,      S[3]=z_1^z_2^z_3^z_5^z_6 ,
                           // S[4]=0,                S[5]=z_3^z_5^z_6,      S[6]=z_0^z_1^z_3^z_4,  S[7]=z_3^z_5^z_6,

    Z = (T[2] & U[0]) ^ Z; // Z=z_8
    S[2] = S[2] ^ Z;       // S[2]=z_3^z_5^z_6^z_8
    S[5] = S[5] ^ Z;       // S[5]=z_3^z_5^z_6^z_8
    S[7] = S[7] ^ Z;       // S[7]=z_3^z_5^z_6^z_8
    Z = (T[2] & U[0]) ^ Z; // Z=0
                           // S[0]=z_0^z_2^z_3^z_5,  S[1]=z_1^z_2^z_4^z_5,  S[2]=z_3^z_5^z_6^z_8,  S[3]=z_1^z_2^z_3^z_5^z_6 ,
                           // S[4]=0,                S[5]=z_3^z_5^z_6^z_8,  S[6]=z_0^z_1^z_3^z_4,  S[7]=z_3^z_5^z_6^z_8,

    Z = (T[1] & U[6]) ^ Z; // Z=z_9
    S[2] = S[2] ^ Z;       // S[2]=z_3^z_5^z_6^z_8^z_9
    S[3] = S[3] ^ Z;       // S[3]=z_1^z_2^z_3^z_5^z_6^z_9
    S[6] = S[6] ^ Z;       // S[6]=z_0^z_1^z_3^z_4^z_9
    Z = (T[1] & U[6]) ^ Z; // Z=0
                           // S[0]=z_0^z_2^z_3^z_5,  S[1]=z_1^z_2^z_4^z_5,  S[2]=z_3^z_5^z_6^z_8^z_9,  S[3]=z_1^z_2^z_3^z_5^z_6^z_9 ,
                           // S[4]=0,                S[5]=z_3^z_5^z_6^z_8,  S[6]=z_0^z_1^z_3^z_4^z_9,  S[7]=z_3^z_5^z_6^z_8,

    T[1] = T[1] ^ T[0];    // T[1]=t_45
    U[6] = U[6] ^ U[4];    // U[6]=y_8
    Z = (T[1] & U[6]) ^ Z; // Z=z_10

    S[4] = S[4] ^ Z; // S[4]=z_10
    S[5] = S[5] ^ Z; // S[5]=z_3^z_5^z_6^z_8^z_10
    S[6] = S[6] ^ Z; // S[6]=z_0^z_1^z_3^z_4^z_9^z_10

    Z = (T[1] & U[6]) ^ Z; // Z=0
    T[1] = T[1] ^ T[0];    // T[1]=t_40
    U[6] = U[6] ^ U[4];    // U[6]=y_0

    // S[0]=z_0^z_2^z_3^z_5,  S[1]=z_1^z_2^z_4^z_5,       S[2]=z_3^z_5^z_6^z_8^z_9,       S[3]=z_1^z_2^z_3^z_5^z_6^z_9 ,
    // S[4]=z_10,             S[5]=z_3^z_5^z_6^z_8^z_10,  S[6]=z_0^z_1^z_3^z_4^z_9^z_10,  S[7]=z_3^z_5^z_6^z_8,

    Z = (T[0] & U[4]) ^ Z; // Z=z_11
    S[2] = S[2] ^ Z;       // S[2]=z_3^z_5^z_6^z_8^z_9^z_11
    S[3] = S[3] ^ Z;       // S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11
    S[4] = S[4] ^ Z;       // S[4]=z_10^z_11
    S[5] = S[5] ^ Z;       // S[5]=z_3^z_5^z_6^z_8^z_10^z_11
    Z = (T[0] & U[4]) ^ Z; // Z=0
                           // S[0]=z_0^z_2^z_3^z_5,    S[1]=z_1^z_2^z_4^z_5,            S[2]=z_3^z_5^z_6^z_8^z_9^z_11,  S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11,
                           // S[4]=z_10^z_11,          S[5]=z_3^z_5^z_6^z_8^z_10^z_11,  S[6]=z_0^z_1^z_3^z_4^z_9^z_10,  S[7]=z_3^z_5^z_6^z_8,

    T[4] = T[4] ^ T[1] ^ T[0] ^ T[2]; // T[4]=t_44
    U[7] = U[7] ^ U[6] ^ U[5] ^ U[4]; // U[7]=y_10
    Z = (T[4] & U[7]) ^ Z;            // Z=z_12
    S[4] = S[4] ^ Z;                  // S[4]=z_10^z_11^z_12
    S[6] = S[6] ^ Z;                  // S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12
    S[7] = S[7] ^ Z;                  // S[7]=z_3^z_5^z_6^z_8^z_12
    Z = (T[4] & U[7]) ^ Z;            // Z=0
    T[4] = T[4] ^ T[1] ^ T[0] ^ T[2]; // T[4]=t_37
    U[7] = U[7] ^ U[6] ^ U[5] ^ U[4]; // U[7]=y_3

    // S[0]=z_0^z_2^z_3^z_5,    S[1]=z_1^z_2^z_4^z_5,            S[2]=z_3^z_5^z_6^z_8^z_9^z_11,        S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11,
    // S[4]=z_10^z_11^z_12,     S[5]=z_3^z_5^z_6^z_8^z_10^z_11,  S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12 ,  S[7]=z_3^z_5^z_6^z_8^z_12 ,

    T[0] = T[0] ^ T[2];    // T[0]=t_42
    U[7] = U[7] ^ U[4];    // U[7]=y_14
    Z = (T[0] & U[7]) ^ Z; // Z=z_13
    S[1] = S[1] ^ Z;       // S[1]=z_1^z_2^z_4^z_5^z_13
    S[6] = S[6] ^ Z;       // S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12^z_13
    S[7] = S[7] ^ Z;       // S[7]=z_3^z_5^z_6^z_8^z_12^z_13
    Z = (T[0] & U[7]) ^ Z; // Z=0
    T[0] = T[0] ^ T[2];    // T[0]=t_29
    U[7] = U[7] ^ U[4];    // U[7]=y_3

    // S[0]=z_0^z_2^z_3^z_5,    S[1]=z_1^z_2^z_4^z_5^z_13,       S[2]=z_3^z_5^z_6^z_8^z_9^z_11,            S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11,
    // S[4]=z_10^z_11^z_12,     S[5]=z_3^z_5^z_6^z_8^z_10^z_11,  S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12^z_13,  S[7]=z_3^z_5^z_6^z_8^z_12^z_13,

    T[1] = T[1] ^ T[4];    // T[1]=t_43
    U[6] = U[6] ^ U[5];    // U[6]=y_12
    Z = (T[1] & U[6]) ^ Z; // Z=z_14
    S[1] = S[1] ^ Z;       // S[1]=z_1^z_2^z_4^z_5^z_13^z_14
    S[4] = S[4] ^ Z;       // S[4]=z_10^z_11^z_14
    Z = (T[1] & U[6]) ^ Z; // Z=0
    T[1] = T[1] ^ T[4];    // T[1]=t_40
    U[6] = U[6] ^ U[5];    // U[6]=y_0
                           // S[0]=z_0^z_2^z_3^z_5,      S[1]=z_1^z_2^z_4^z_5^z_13^z_14,  S[2]=z_3^z_5^z_6^z_8^z_9^z_11,            S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11,
                           // S[4]=z_10^z_11^z_12^z_14,  S[5]=z_3^z_5^z_6^z_8^z_10^z_11,  S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12^z_13,  S[7]=z_3^z_5^z_6^z_8^z_12^z_13,

    Z = (T[4] & U[5]) ^ Z; // Z=z_15
    S[2] = S[2] ^ Z;       // S[2]=z_3^z_5^z_6^z_8^z_9^z_11^z_15
    S[3] = S[3] ^ Z;       // S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11^z_15
    S[4] = S[4] ^ Z;       // S[4]=z_10^z_11^z_14^z_15
    S[7] = S[7] ^ Z;       // S[7]=z_3^z_5^z_6^z_8^z_12^z_13^z_15
    Z = (T[4] & U[5]) ^ Z; // Z=0

    // S[0]=z_0^z_2^z_3^z_5,           S[1]=z_1^z_2^z_4^z_5^z_13^z_14,  S[2]=z_3^z_5^z_6^z_8^z_9^z_11^z_15,       S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11^z_15,
    // S[4]=z_10^z_11^z_12^z_14^z_15,  S[5]=z_3^z_5^z_6^z_8^z_10^z_11,  S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12^z_13,  S[7]=z_3^z_5^z_6^z_8^z_12^z_13^z_15,

    T[4] = T[4] ^ T[2];    // T[4]=t_41
    U[7] = U[7] ^ U[5];    // U[7]=y_16
    Z = (T[4] & U[7]) ^ Z; // Z=z_16
    S[1] = S[1] ^ Z;       // S[1]=z_1^z_2^z_4^z_5^z_13^z_14^z_16
    S[4] = S[4] ^ Z;       // S[4]=z_10^z_11^z_14^z_15^z_16
    S[5] = S[5] ^ Z;       // S[5]=z_3^z_5^z_6^z_8^z_10^z_11^z_16
    S[7] = S[7] ^ Z;       // S[7]=z_3^z_5^z_6^z_8^z_12^z_13^z_15^z_16
    Z = (T[4] & U[7]) ^ Z; // Z=0
    T[4] = T[4] ^ T[2];    // T[4]=t_37
    U[7] = U[7] ^ U[5];    // U[7]=y_3

    // S[0]=z_0^z_2^z_3,                   S[1]=z_1^z_2^z_4^z_5^z_13^z_14^z_16,  S[2]=z_3^z_5^z_6^z_8^z_9^z_11^z_15,       S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11^z_15,
    // S[4]=z_10^z_11^z_12^z_14^z_15^z_16, S[5]=z_3^z_5^z_6^z_8^z_10^z_11^z_16,  S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12^z_13,  S[7]=z_3^z_5^z_6^z_8^z_12^z_13^z_15^z_16,

    Z = (T[2] & U[7]) ^ Z; // Z=z_17
    S[1] = S[1] ^ Z;       // S[1]=z_1^z_2^z_4^z_5^z_13^z_14^z_16^z_17
    S[2] = S[2] ^ Z;       // S[2]=z_3^z_5^z_6^z_8^z_9^z_11^z_15^z_17
    S[3] = S[3] ^ Z;       // S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11^z_15^z_17
    S[5] = S[5] ^ Z;       // S[5]=z_3^z_5^z_6^z_8^z_10^z_11^z_16^z_17
    Z = (T[2] & U[7]) ^ Z; // Z=0
                           // S[0]=z_0^z_2^z_3^z_5,                         S[1]=z_1^z_2^z_4^z_5^z_13^z_14^z_16^z_17 ,  S[2]=z_3^z_5^z_6^z_8^z_9^z_11^z_15^z_17,
                           // S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11^z_15^z_17,  S[4]=z_10^z_11^z_12^z_14^z_15^z_16,         S[5]=z_3^z_5^z_6^z_8^z_10^z_11^z_16^z_17,
                           // S[6]=z_0^z_1^z_3^z_4^z_9^z_10^z_12^z_13,      S[7]=z_3^z_5^z_6^z_8^z_12^z_13^z_15^z_16,

    T[4] = T[4] ^ T[2];          // T[4]=t_41
    U[0] = U[0] ^ U[3];          // U[0]=y_17
    S[3] = (T[4] & U[0]) ^ S[3]; // T[4]& U[0]=z_7 and S[3]=z_1^z_2^z_3^z_5^z_6^z_9^z_11^z_15^z_17 ^z_7
    T[4] = T[4] ^ T[2];          // T[4]=t_37
    U[0] = U[0] ^ U[3];          // U[0]=y_7

    /*** This part is used to generate the input of S-box, the result is stored in U[] ***/
    i = U[6] ^ U[5] ^ U[3] ^ U[4] ^ U[2] ^ U[0];
    j = 1 ^ i;
    U[2] = j;

    U[3] = U[6] ^ U[5] ^ U[3] ^ U[4] ^ U[1];
    U[0] = U[0] ^ U[5] ^ U[3] ^ U[7];
    U[6] = U[6] ^ U[3] ^ U[4] ^ U[1];

    i = U[5] ^ U[7] ^ U[3] ^ U[2] ^ U[1] ^ U[0];
    j = 1 ^ i;
    U[5] = j;

    i = U[7] ^ U[6] ^ U[5] ^ U[2] ^ U[1];
    j = 1 ^ i;
    U[7] = j;

    T[4] = T[4] ^ T[3];
    T[3] = T[3] ^ T[2];
    T[2] = T[2] ^ T[5];
    T[4] = T[4] ^ T[2];

    T[1] = (T[0] & T[4]) ^ T[1];
    T[0] = (T[1] & T[2]) ^ T[0];
    T[1] = T[0] ^ T[1];

    T[2] = (T[1] & T[3]) ^ T[2];
    T[4] = (T[5] & T[2]) ^ T[4];
    T[5] = T[5] ^ T[4];
    T[3] = T[3] ^ T[2];

    T[4] = T[4] ^ T[2];
    T[4] = T[4] ^ T[0];
    T[5] = (T[3] & T[4]) ^ T[5];
    T[5] = T[5] ^ T[2];
    T[4] = T[4] ^ T[0];
    T[3] = T[3] ^ T[2];
    T[4] = (T[1] & T[3]) ^ T[4];

    T[3] = T[3] ^ U[6];
    U[6] = U[6] ^ U[3] ^ U[4] ^ U[1];

    T[2] = T[2] ^ U[7];
    U[7] = U[7] ^ U[4] ^ U[1];

    T[1] = T[1] ^ U[5];
    U[5] = U[5] ^ U[3];

    T[0] = T[0] ^ U[7];
    U[7] = U[7] ^ U[3] ^ U[4] ^ U[1] ^ U[0];

    T[3] = (U[6] & U[5]) ^ T[3];
    U[6] = U[6] ^ U[4];

    i = U[5] ^ U[3] ^ U[2] ^ U[1];
    j = 1 ^ i;
    U[5] = j;

    T[2] = (U[1] & U[4]) ^ T[2];

    i = U[4] ^ U[3] ^ U[2] ^ U[1];
    j = 1 ^ i;
    U[4] = j;

    U[1] = U[1] ^ U[7] ^ U[6] ^ U[3];

    T[1] = (U[7] & U[1]) ^ T[1];

    i = U[1] ^ U[7];
    j = 1 ^ i;
    U[1] = j;

    i = U[7] ^ U[5] ^ U[3] ^ U[1] ^ U[0];
    j = 1 ^ i;
    U[7] = j;

    T[0] = (U[5] & U[7]) ^ T[0];
    U[7] = U[7] ^ U[5] ^ U[2] ^ U[1] ^ U[0];
    U[5] = U[5] ^ U[6] ^ U[3] ^ U[0];

    T[3] = (U[5] & U[7]) ^ T[3];
    T[1] = (U[5] & U[7]) ^ T[1];

    i = U[5] ^ U[7] ^ U[1] ^ U[0];
    j = 1 ^ i;
    U[5] = j;

    U[7] = U[7] ^ U[3] ^ U[4];

    T[2] = (U[5] & U[7]) ^ T[2];
    T[0] = (U[5] & U[7]) ^ T[0];

    U[7] = U[7] ^ U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[2] ^ U[1];
    U[5] = U[5] ^ U[6] ^ U[2] ^ U[1];

    T[3] = T[3] ^ T[2];
    T[2] = (U[6] & U[7]) ^ T[2];
    i = U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[2] ^ U[0];
    j = 1 ^ i;
    U[6] = j;

    i = U[7] ^ U[2] ^ U[0];
    j = 1 ^ i;
    U[7] = j;

    T[1] = T[1] ^ T[0];
    T[0] = (U[5] & U[7]) ^ T[0];
    U[7] = U[7] ^ U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[2] ^ U[1];

    i = U[5] ^ U[3] ^ U[2];
    j = 1 ^ i;
    U[5] = j;

    T[2] = T[2] ^ T[0];
    T[0] = (U[6] & U[7]) ^ T[0];
    U[6] = U[6] ^ U[5] ^ U[4] ^ U[3] ^ U[1] ^ U[0];

    i = U[7] ^ U[3];
    j = 1 ^ i;
    U[7] = j;
}

int main()
{
    int U[8], T[6], S[8], i, j, Z, X, ii, input, output;
    for (X = 0; X < 256; ++X)
    {
        for (ii = 0; ii < 6; ++ii)
            T[ii] = 0;
        for (ii = 0; ii < 8; ++ii)
            U[ii] = (X >> (7 - ii)) & 1;
        //algorithm 6
        algorithm_6(U, T, i, j);

        // algorithm 7
        for (ii = 0; ii < 8; ++ii)
            S[ii] = 0;
        Z = 0;
        algorithm_7(U, T, S, Z, i, j);

        for (output = 0, input = 0, ii = 0; ii < 8; ++ii)
        {
            input = (input << 1) | U[ii];
            output = (output << 1) | S[ii];
        }
        printf("%02X: %02X  ", input, output);
        if (X % 16 == 15)
            printf("\n");
    }

    return 0;
}
